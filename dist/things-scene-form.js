!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@hatiolab/things-scene"),require("hls.js")):"function"==typeof define&&define.amd?define(["exports","@hatiolab/things-scene","hls.js"],t):t((e=e||self)["things-scene-form"]={},e.scene,e.Hls)}(this,function(e,t,r){"use strict";r=r&&r.hasOwnProperty("default")?r.default:r;const a={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"select",label:"method",name:"method",property:{options:[{display:"GET",value:"GET"},{display:"POST",value:"POST"}]}},{type:"string",label:"action",name:"action"},{type:"number",label:"period",name:"period"},{type:"string",label:"name",name:"name"},{type:"string",label:"authorization",name:"authorization"},{type:"select",label:"format",name:"format",property:{options:[{display:"JSON",value:"JSON"},{display:"TEXT",value:"TEXT"}]}},{type:"checkbox",label:"with-credentials",name:"withCredentials"},{type:"checkbox",label:"submit-on-load",name:"submitOnLoad"}],"value-property":"action"};class n extends t.HTMLOverlayContainer{dispose(){super.dispose(),this._stopRepeater()}setElementProperties(e){var{action:t="",method:r="POST",name:a=""}=this.state;e.action=t,e.method=r,e.name=a}get action(){return this.state.action}set action(e){this.setState("action",e),this._startRepeater()}get period(){return 1e3*this.state.period}set period(e){this.setState("period",e),this._startRepeater()}_startRepeater(){this._stopRepeater(),this.app.isViewMode&&this.period&&(this._repeatInterval=setInterval(this._submit.bind(this),this.period))}_stopRepeater(){this._repeatInterval&&clearInterval(this._repeatInterval)}_onload(e){var t=e.target.response;try{this.setState("data","JSON"==this.get("format")?JSON.parse(t):t)}catch(e){console.error(e)}}oncreate_element(e){if(this.app.isViewMode){e.onsubmit=(t=>{t.preventDefault();var r=e.action,a=new XMLHttpRequest,n=[].filter.call(e.elements,function(e){return"radio"!=e.type&&"checkbox"!=e.type||e.checked}).filter(function(e){return!!e.name}).filter(function(e){return!e.disabled}).map(function(e){return encodeURIComponent(e.name)+"="+encodeURIComponent(e.value)}).join("&");return a.onloadend=this._onload.bind(this),"get"==e.method?a.open(e.method,r+"?"+n):a.open(e.method,r),a.setRequestHeader("Content-Type",["x-www-form-urlencoded","json"].map(e=>"application/"+e).concat("text/plain").join(";")),this.get("authorization")&&a.setRequestHeader("Authorization",this.get("authorization")),this.get("withCredentials")&&(a.withCredentials=!0),"get"==e.method?a.send():a.send(n),!1}),this.getState("submitOnLoad")&&setTimeout(this._submit.bind(this),100),this._startRepeater()}}_submit(){this.element.dispatchEvent(new Event("submit",{cancelable:!0}))}get nature(){return a}}t.Component.register("form",n);const s={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"legend",name:"legend"}]};class i extends t.HTMLOverlayContainer{setElementProperties(e){var{legend:t=""}=this.state;t?this.legendElement.textContent=t:(this._legendElement&&this.element.removeChild(this._legendElement),delete this._legendElement)}get legendElement(){if(!this._legendElement){var e=document.createElement("legend");this.element.appendChild(e),this._legendElement=e}return this._legendElement}get nature(){return s}}t.Component.register("fieldset",i);const l={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"value",name:"value"},{type:"number",label:"size",name:"size"},{type:"string",label:"name",name:"name"},{type:"checkbox",label:"submit-on-change",name:"submitOnChange"},{type:"checkbox",label:"copy-value-to-data",name:"copyValueToData"},{type:"string",label:"text-field",name:"textField"},{type:"string",label:"value-field",name:"valueField"},{type:"options",label:"options",name:"options"}],"value-property":"value"};class o extends t.HTMLOverlayElement{get nature(){return l}buildOptions(){var e,{options:t=[],textField:r,valueField:a,value:n}=this.state;!t instanceof Array&&(t=[]),this.element.textContent="",t.map&&t.map((t,n)=>{let s,i;return s=r?"(index)"==r?n:t&&t[r]:t&&(t.text||t),i=a?"(index)"==a?n:t&&t[a]:t&&(t.value||t),void 0===e&&(e=i),i==this.value&&(e=this.value),{text:s,value:i}}).forEach(e=>{var t=document.createElement("option");t.value="string"==typeof e.value?e.value:JSON.stringify(e.value),t.text=e.text,this.element.appendChild(t)}),void 0!==e&&this.value!==e&&(this.value=JSON.stringify(e)),this.element.value!=this.value&&(this.element.value=this.value,this.element.dispatchEvent(new Event("change")))}createElement(){super.createElement(),this.buildOptions();var e=this.element;e.value=this.get("value")||"",e.onchange=(t=>{this.set("value",e.value),this.get("submitOnChange")&&e.form&&e.form.dispatchEvent(new Event("submit",{cancelable:!0}))})}setElementProperties(e){var{size:t,name:r}=this.state;e.size=t,e.name=r}onchange(e,r){if(super.onchange(e,r),e.hasOwnProperty("value")&&this.element){if(this.element.value=e.value,this.get("copyValueToData"))try{this.data=JSON.parse(e.value)}catch(r){t.warn(r),this.data=e.value}this.get("submitOnChange")&&this.element.form&&this.element.form.dispatchEvent(new Event("submit",{cancelable:!0}))}e.hasOwnProperty("options")&&this.buildOptions()}get options(){return this.getState("options")}set options(e){this.setState("options",e)}}t.Component.register("select",o);const h={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"name",name:"name"},{type:"string",label:"value",name:"text"},{type:"string",label:"placeholder",name:"placeholder"},{type:"checkbox",label:"readonly",name:"readonly"},{type:"checkbox",label:"disabled",name:"disabled"},{type:"number",label:"max-length",name:"maxlength"}],"value-property":"text"};class u extends t.HTMLOverlayElement{get nature(){return h}get tagName(){return"textarea"}createElement(){super.createElement(),this.element.style.resize="none",this.element.onchange=(e=>{this.value=this.element.value})}setElementProperties(e){var{name:t="",placeholder:r="",disabled:a,readonly:n,maxlength:s}=this.state;try{e.name=t,e.placeholder=r,e.disabled=a,e.readonly=n,e.maxlength=s,e.value=this.value}catch(e){error(e)}this.data=this.value}}t.Component.register("textarea",u);const p={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"value",name:"text"}],"value-property":"text"};class c extends t.HTMLOverlayElement{get tagName(){return"button"}get nature(){return p}setElementProperties(e){this.element.textContent=this.value}}t.Component.register("button",c);const m={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"name",name:"name"},{type:"string",label:"value",name:"text"},{type:"string",label:"placeholder",name:"placeholder"},{type:"checkbox",label:"readonly",name:"readonly"},{type:"checkbox",label:"disabled",name:"disabled"},{type:"number",label:"max-length",name:"maxlength"},{type:"checkbox",label:"submit-on-change",name:"submitOnChange"}],"value-property":"text"};class d extends t.HTMLOverlayElement{get nature(){return m}get tagName(){return"input"}get inputType(){return this.get("type").substr(6)}createElement(){super.createElement(),this.element.onchange=(e=>{this.value=this.element.value})}setElementProperties(e){var{name:r="",placeholder:a="",disabled:n,readonly:s,maxlength:i}=this.state;try{e.type=this.inputType,e.name=r,e.placeholder=a,e.disabled=n,e.readonly=s,e.maxlength=i,e.value=this.value}catch(e){t.error(e)}this.data=this.value}onchange(e,t){super.onchange(e,t);var r=this.nature["value-property"];r&&r in e&&this.element&&(this.element.value=e.text,this.get("submitOnChange")&&this.element.form&&this.element.form.dispatchEvent(new Event("submit",{cancelable:!0})))}}["input","input-text","input-password","input-email","input-search","input-time","input-datetime-local","input-month","input-week"].forEach(e=>t.Component.register(e,d));const g={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"value",name:"value"},{type:"number",label:"size",name:"size"},{type:"string",label:"name",name:"name"},{type:"checkbox",label:"checked",name:"checked"}],"value-property":"value"};class f extends d{get nature(){return g}get tagName(){return"input"}get inputType(){return"radio"}createElement(){if(this.element=document.createElement("label"),this.element){var e=document.createElement("input");this.element.appendChild(e);var r=document.createTextNode(this.get("text"));this.element.appendChild(r),this.setElementProperties(this.element),this.parent.isHTMLElement&&this.parent.isHTMLElement()?this.parent.element.appendChild(this.element):this.root.model_layer.overlay.appendChild(this.element),t.Component.reposition(this),this.oncreate_element&&this.oncreate_element(this.element)}}setElementProperties(e){var t=this.element.querySelector("text"),r=this.element.querySelector("input"),{text:a,checked:n,value:s}=this.state;t&&(t.textContent=a),r&&(r.checked=n,r.value=s),super.setElementProperties(r)}}t.Component.register("input-radio",f);const b={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"value",name:"value"},{type:"number",label:"size",name:"size"},{type:"string",label:"name",name:"name"},{type:"checkbox",label:"checked",name:"checked"},{type:"checkbox",label:"submit-on-change",name:"submitOnChange"}],"value-property":"value"};class v extends d{get nature(){return b}get tagName(){return"input"}get inputType(){return"checkbox"}get hasTextProperty(){return!0}createElement(){if(this.element=document.createElement("label"),this.element){var e=document.createElement("input");this.element.appendChild(e);var r=document.createTextNode(this.get("text"));this.element.appendChild(r),this.setElementProperties(this.element),this.parent.isHTMLElement&&this.parent.isHTMLElement()?this.parent.element.appendChild(this.element):this.root.model_layer.overlay.appendChild(this.element),t.Component.reposition(this),this.oncreate_element&&this.oncreate_element(this.element)}}setElementProperties(e){var t=this.element.querySelector("text"),r=this.element.querySelector("input"),{text:a,checked:n,value:s}=this.state;t&&(t.textContent=a),r&&(r.checked=n,r.value=s),super.setElementProperties(r)}}t.Component.register("input-checkbox",v);const y={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"src",name:"src"}],"value-property":"src"};class x extends t.HTMLOverlayElement{setElementProperties(e){var{src:t=""}=this.state;e.src!=t&&(e.src=t)}get nature(){return y}}t.Component.register("iframe",x);const _={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"src",name:"src"}],"value-property":"src"};class A extends t.HTMLOverlayElement{setElementProperties(e){var{src:t=""}=this.state;e.src!=t&&(e.src=t)}get src(){return this.get("src")}set src(e){this.set("src",e)}get nature(){return _}}t.Component.register("img",A);const E={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"src",name:"src"},{type:"checkbox",label:"started",name:"started"},{type:"checkbox",label:"controls",name:"controls"}],"value-property":"src"};class k extends t.HTMLOverlayElement{async oncreate_element(e){var{src:t,started:r}=this.state;e.addEventListener("canplay",()=>{this.started&&e.play()}),this.onchangesrc(t),this.onchangestarted(r)}dispose(){this.reset(),super.dispose()}reset(){this._hlsSupporter&&this._hlsSupporter.destroy(),delete this._hlsSupporter}onchange(e,t){super.onchange(e,t),"src"in e&&this.onchangesrc(e.src),"started"in e&&this.onchangestarted(e.started)}setElementProperties(e){var{controls:t}=this.state;t?e.setAttribute("controls",!0):e.removeAttribute("controls")}onchangestarted(e){var t=this.element;e?4==t.readyState&&t.play():t.pause()}onchangesrc(e){this.reset();var t=this.element;t&&(t.src=e,e.endsWith(".m3u8")&&r.isSupported()&&(this._hlsSupporter=new r,this._hlsSupporter.loadSource(e),this._hlsSupporter.attachMedia(t),this._hlsSupporter.on(r.Events.MANIFEST_PARSED,()=>{this.started&&t.play()})))}get src(){return this.getState("src")}set src(e){this.setState("src",e)}get started(){return this.getState("started")}set started(e){this.setState("started",e)}get nature(){return E}}t.Component.register("video",k);const C={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"href",name:"href",property:"href"},{type:"select",label:"target",name:"target",property:{options:[{display:"self",value:"_self"},{display:"blank",value:"_blank"},{display:"parent",value:"_parent"},{display:"top",value:"_top"}]}}],"value-property":"href"};class S extends t.HTMLOverlayContainer{get tagName(){return"a"}get href(){return this.get("href")}set href(e){this.set("href",e)}setElementProperties(e){var{href:t="",target:r}=this.state;e.href!=t&&(e.href=t),e.target=r,0==this.components.length&&(this.element.textContent=this.text||t)}get nature(){return C}}t.Component.register("link",S);const w={mutable:!1,resizable:!0,rotatable:!0};class T extends t.HTMLOverlayContainer{setElementProperties(e){e.textContent=this.text}get tagName(){return"div"}get nature(){return w}}t.Component.register("div",T);const H={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"name",name:"name"},{type:"number",label:"value",name:"text"},{type:"number",label:"min",name:"min"},{type:"number",label:"max",name:"max"},{type:"number",label:"step",name:"step"},{type:"checkbox",label:"submit-on-change",name:"submitOnChange"}],"value-property":"text"};class O extends d{get nature(){return H}setElementProperties(e){super.setElementProperties(e);var{min:t=0,max:r=100,step:a=1}=this.state;e.min=t,e.max=r,e.step=a}}t.Component.register("input-number",O),t.Component.register("input-range",O);const R={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"name",name:"name"},{type:"date",label:"value",name:"text"},{type:"date",label:"min",name:"min"},{type:"date",label:"max",name:"max"},{type:"checkbox",label:"submit-on-change",name:"submitOnChange"}],"value-property":"text"};class M extends d{get nature(){return R}setElementProperties(e){super.setElementProperties(e);var{min:t,max:r}=this.state;e.min=t,e.max=r}}t.Component.register("input-date",M);const P={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"name",name:"name"},{type:"string",label:"value",name:"text"},{type:"checkbox",label:"multiple",name:"multiple"}],"value-property":"text"};class z extends d{get nature(){return P}setElementProperties(e){super.setElementProperties(e),e.multiple=!!this.state.multiple}}t.Component.register("input-file",z);var F,L=(function(e){!function(t){var r=/^\s+/,a=/\s+$/,n=0,s=t.round,i=t.min,l=t.max,o=t.random;function h(e,o){if(o=o||{},(e=e||"")instanceof h)return e;if(!(this instanceof h))return new h(e,o);var u=function(e){var n={r:0,g:0,b:0},s=1,o=null,h=null,u=null,p=!1,c=!1;"string"==typeof e&&(e=function(e){e=e.replace(r,"").replace(a,"").toLowerCase();var t,n=!1;if(w[e])e=w[e],n=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};if(t=j.rgb.exec(e))return{r:t[1],g:t[2],b:t[3]};if(t=j.rgba.exec(e))return{r:t[1],g:t[2],b:t[3],a:t[4]};if(t=j.hsl.exec(e))return{h:t[1],s:t[2],l:t[3]};if(t=j.hsla.exec(e))return{h:t[1],s:t[2],l:t[3],a:t[4]};if(t=j.hsv.exec(e))return{h:t[1],s:t[2],v:t[3]};if(t=j.hsva.exec(e))return{h:t[1],s:t[2],v:t[3],a:t[4]};if(t=j.hex8.exec(e))return{r:M(t[1]),g:M(t[2]),b:M(t[3]),a:L(t[4]),format:n?"name":"hex8"};if(t=j.hex6.exec(e))return{r:M(t[1]),g:M(t[2]),b:M(t[3]),format:n?"name":"hex"};if(t=j.hex4.exec(e))return{r:M(t[1]+""+t[1]),g:M(t[2]+""+t[2]),b:M(t[3]+""+t[3]),a:L(t[4]+""+t[4]),format:n?"name":"hex8"};if(t=j.hex3.exec(e))return{r:M(t[1]+""+t[1]),g:M(t[2]+""+t[2]),b:M(t[3]+""+t[3]),format:n?"name":"hex"};return!1}(e));"object"==typeof e&&(D(e.r)&&D(e.g)&&D(e.b)?(m=e.r,d=e.g,g=e.b,n={r:255*O(m,255),g:255*O(d,255),b:255*O(g,255)},p=!0,c="%"===String(e.r).substr(-1)?"prgb":"rgb"):D(e.h)&&D(e.s)&&D(e.v)?(o=z(e.s),h=z(e.v),n=function(e,r,a){e=6*O(e,360),r=O(r,100),a=O(a,100);var n=t.floor(e),s=e-n,i=a*(1-r),l=a*(1-s*r),o=a*(1-(1-s)*r),h=n%6;return{r:255*[a,l,i,i,o,a][h],g:255*[o,a,a,l,i,i][h],b:255*[i,i,o,a,a,l][h]}}(e.h,o,h),p=!0,c="hsv"):D(e.h)&&D(e.s)&&D(e.l)&&(o=z(e.s),u=z(e.l),n=function(e,t,r){var a,n,s;function i(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}if(e=O(e,360),t=O(t,100),r=O(r,100),0===t)a=n=s=r;else{var l=r<.5?r*(1+t):r+t-r*t,o=2*r-l;a=i(o,l,e+1/3),n=i(o,l,e),s=i(o,l,e-1/3)}return{r:255*a,g:255*n,b:255*s}}(e.h,o,u),p=!0,c="hsl"),e.hasOwnProperty("a")&&(s=e.a));var m,d,g;return s=H(s),{ok:p,format:e.format||c,r:i(255,l(n.r,0)),g:i(255,l(n.g,0)),b:i(255,l(n.b,0)),a:s}}(e);this._originalInput=e,this._r=u.r,this._g=u.g,this._b=u.b,this._a=u.a,this._roundA=s(100*this._a)/100,this._format=o.format||u.format,this._gradientType=o.gradientType,this._r<1&&(this._r=s(this._r)),this._g<1&&(this._g=s(this._g)),this._b<1&&(this._b=s(this._b)),this._ok=u.ok,this._tc_id=n++}function u(e,t,r){e=O(e,255),t=O(t,255),r=O(r,255);var a,n,s=l(e,t,r),o=i(e,t,r),h=(s+o)/2;if(s==o)a=n=0;else{var u=s-o;switch(n=h>.5?u/(2-s-o):u/(s+o),s){case e:a=(t-r)/u+(t<r?6:0);break;case t:a=(r-e)/u+2;break;case r:a=(e-t)/u+4}a/=6}return{h:a,s:n,l:h}}function p(e,t,r){e=O(e,255),t=O(t,255),r=O(r,255);var a,n,s=l(e,t,r),o=i(e,t,r),h=s,u=s-o;if(n=0===s?0:u/s,s==o)a=0;else{switch(s){case e:a=(t-r)/u+(t<r?6:0);break;case t:a=(r-e)/u+2;break;case r:a=(e-t)/u+4}a/=6}return{h:a,s:n,v:h}}function c(e,t,r,a){var n=[P(s(e).toString(16)),P(s(t).toString(16)),P(s(r).toString(16))];return a&&n[0].charAt(0)==n[0].charAt(1)&&n[1].charAt(0)==n[1].charAt(1)&&n[2].charAt(0)==n[2].charAt(1)?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0):n.join("")}function m(e,t,r,a){return[P(F(a)),P(s(e).toString(16)),P(s(t).toString(16)),P(s(r).toString(16))].join("")}function d(e,t){t=0===t?0:t||10;var r=h(e).toHsl();return r.s-=t/100,r.s=R(r.s),h(r)}function g(e,t){t=0===t?0:t||10;var r=h(e).toHsl();return r.s+=t/100,r.s=R(r.s),h(r)}function f(e){return h(e).desaturate(100)}function b(e,t){t=0===t?0:t||10;var r=h(e).toHsl();return r.l+=t/100,r.l=R(r.l),h(r)}function v(e,t){t=0===t?0:t||10;var r=h(e).toRgb();return r.r=l(0,i(255,r.r-s(-t/100*255))),r.g=l(0,i(255,r.g-s(-t/100*255))),r.b=l(0,i(255,r.b-s(-t/100*255))),h(r)}function y(e,t){t=0===t?0:t||10;var r=h(e).toHsl();return r.l-=t/100,r.l=R(r.l),h(r)}function x(e,t){var r=h(e).toHsl(),a=(r.h+t)%360;return r.h=a<0?360+a:a,h(r)}function _(e){var t=h(e).toHsl();return t.h=(t.h+180)%360,h(t)}function A(e){var t=h(e).toHsl(),r=t.h;return[h(e),h({h:(r+120)%360,s:t.s,l:t.l}),h({h:(r+240)%360,s:t.s,l:t.l})]}function E(e){var t=h(e).toHsl(),r=t.h;return[h(e),h({h:(r+90)%360,s:t.s,l:t.l}),h({h:(r+180)%360,s:t.s,l:t.l}),h({h:(r+270)%360,s:t.s,l:t.l})]}function k(e){var t=h(e).toHsl(),r=t.h;return[h(e),h({h:(r+72)%360,s:t.s,l:t.l}),h({h:(r+216)%360,s:t.s,l:t.l})]}function C(e,t,r){t=t||6,r=r||30;var a=h(e).toHsl(),n=360/r,s=[h(e)];for(a.h=(a.h-(n*t>>1)+720)%360;--t;)a.h=(a.h+n)%360,s.push(h(a));return s}function S(e,t){t=t||6;for(var r=h(e).toHsv(),a=r.h,n=r.s,s=r.v,i=[],l=1/t;t--;)i.push(h({h:a,s:n,v:s})),s=(s+l)%1;return i}h.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,r,a,n=this.toRgb();return e=n.r/255,r=n.g/255,a=n.b/255,.2126*(e<=.03928?e/12.92:t.pow((e+.055)/1.055,2.4))+.7152*(r<=.03928?r/12.92:t.pow((r+.055)/1.055,2.4))+.0722*(a<=.03928?a/12.92:t.pow((a+.055)/1.055,2.4))},setAlpha:function(e){return this._a=H(e),this._roundA=s(100*this._a)/100,this},toHsv:function(){var e=p(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=p(this._r,this._g,this._b),t=s(360*e.h),r=s(100*e.s),a=s(100*e.v);return 1==this._a?"hsv("+t+", "+r+"%, "+a+"%)":"hsva("+t+", "+r+"%, "+a+"%, "+this._roundA+")"},toHsl:function(){var e=u(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=u(this._r,this._g,this._b),t=s(360*e.h),r=s(100*e.s),a=s(100*e.l);return 1==this._a?"hsl("+t+", "+r+"%, "+a+"%)":"hsla("+t+", "+r+"%, "+a+"%, "+this._roundA+")"},toHex:function(e){return c(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return function(e,t,r,a,n){var i=[P(s(e).toString(16)),P(s(t).toString(16)),P(s(r).toString(16)),P(F(a))];if(n&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)&&i[3].charAt(0)==i[3].charAt(1))return i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0)+i[3].charAt(0);return i.join("")}(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:s(this._r),g:s(this._g),b:s(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+s(this._r)+", "+s(this._g)+", "+s(this._b)+")":"rgba("+s(this._r)+", "+s(this._g)+", "+s(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:s(100*O(this._r,255))+"%",g:s(100*O(this._g,255))+"%",b:s(100*O(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+s(100*O(this._r,255))+"%, "+s(100*O(this._g,255))+"%, "+s(100*O(this._b,255))+"%)":"rgba("+s(100*O(this._r,255))+"%, "+s(100*O(this._g,255))+"%, "+s(100*O(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(T[c(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+m(this._r,this._g,this._b,this._a),r=t,a=this._gradientType?"GradientType = 1, ":"";if(e){var n=h(e);r="#"+m(n._r,n._g,n._b,n._a)}return"progid:DXImageTransform.Microsoft.gradient("+a+"startColorstr="+t+",endColorstr="+r+")"},toString:function(e){var t=!!e;e=e||this._format;var r=!1,a=this._a<1&&this._a>=0;return t||!a||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"hex4"!==e&&"hex8"!==e&&"name"!==e?("rgb"===e&&(r=this.toRgbString()),"prgb"===e&&(r=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(r=this.toHexString()),"hex3"===e&&(r=this.toHexString(!0)),"hex4"===e&&(r=this.toHex8String(!0)),"hex8"===e&&(r=this.toHex8String()),"name"===e&&(r=this.toName()),"hsl"===e&&(r=this.toHslString()),"hsv"===e&&(r=this.toHsvString()),r||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},clone:function(){return h(this.toString())},_applyModification:function(e,t){var r=e.apply(null,[this].concat([].slice.call(t)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(b,arguments)},brighten:function(){return this._applyModification(v,arguments)},darken:function(){return this._applyModification(y,arguments)},desaturate:function(){return this._applyModification(d,arguments)},saturate:function(){return this._applyModification(g,arguments)},greyscale:function(){return this._applyModification(f,arguments)},spin:function(){return this._applyModification(x,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(C,arguments)},complement:function(){return this._applyCombination(_,arguments)},monochromatic:function(){return this._applyCombination(S,arguments)},splitcomplement:function(){return this._applyCombination(k,arguments)},triad:function(){return this._applyCombination(A,arguments)},tetrad:function(){return this._applyCombination(E,arguments)}},h.fromRatio=function(e,t){if("object"==typeof e){var r={};for(var a in e)e.hasOwnProperty(a)&&(r[a]="a"===a?e[a]:z(e[a]));e=r}return h(e,t)},h.equals=function(e,t){return!(!e||!t)&&h(e).toRgbString()==h(t).toRgbString()},h.random=function(){return h.fromRatio({r:o(),g:o(),b:o()})},h.mix=function(e,t,r){r=0===r?0:r||50;var a=h(e).toRgb(),n=h(t).toRgb(),s=r/100;return h({r:(n.r-a.r)*s+a.r,g:(n.g-a.g)*s+a.g,b:(n.b-a.b)*s+a.b,a:(n.a-a.a)*s+a.a})},h.readability=function(e,r){var a=h(e),n=h(r);return(t.max(a.getLuminance(),n.getLuminance())+.05)/(t.min(a.getLuminance(),n.getLuminance())+.05)},h.isReadable=function(e,t,r){var a,n,s=h.readability(e,t);switch(n=!1,(a=function(e){var t,r;t=((e=e||{level:"AA",size:"small"}).level||"AA").toUpperCase(),r=(e.size||"small").toLowerCase(),"AA"!==t&&"AAA"!==t&&(t="AA");"small"!==r&&"large"!==r&&(r="small");return{level:t,size:r}}(r)).level+a.size){case"AAsmall":case"AAAlarge":n=s>=4.5;break;case"AAlarge":n=s>=3;break;case"AAAsmall":n=s>=7}return n},h.mostReadable=function(e,t,r){var a,n,s,i,l=null,o=0;n=(r=r||{}).includeFallbackColors,s=r.level,i=r.size;for(var u=0;u<t.length;u++)(a=h.readability(e,t[u]))>o&&(o=a,l=h(t[u]));return h.isReadable(e,l,{level:s,size:i})||!n?l:(r.includeFallbackColors=!1,h.mostReadable(e,["#fff","#000"],r))};var w=h.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},T=h.hexNames=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t}(w);function H(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function O(e,r){(function(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var a=function(e){return"string"==typeof e&&-1!=e.indexOf("%")}(e);return e=i(r,l(0,parseFloat(e))),a&&(e=parseInt(e*r,10)/100),t.abs(e-r)<1e-6?1:e%r/parseFloat(r)}function R(e){return i(1,l(0,e))}function M(e){return parseInt(e,16)}function P(e){return 1==e.length?"0"+e:""+e}function z(e){return e<=1&&(e=100*e+"%"),e}function F(e){return t.round(255*parseFloat(e)).toString(16)}function L(e){return M(e)/255}var N,I,q,j=(I="[\\s|\\(]+("+(N="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+N+")[,|\\s]+("+N+")\\s*\\)?",q="[\\s|\\(]+("+N+")[,|\\s]+("+N+")[,|\\s]+("+N+")[,|\\s]+("+N+")\\s*\\)?",{CSS_UNIT:new RegExp(N),rgb:new RegExp("rgb"+I),rgba:new RegExp("rgba"+q),hsl:new RegExp("hsl"+I),hsla:new RegExp("hsla"+q),hsv:new RegExp("hsv"+I),hsva:new RegExp("hsva"+q),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function D(e){return!!j.CSS_UNIT.exec(e)}e.exports?e.exports=h:window.tinycolor=h}(Math)}(F={exports:{}},F.exports),F.exports);const N={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"name",name:"name"},{type:"color",label:"value",name:"text",property:{withoutAlpha:!0,valueType:"hex"}}],"value-property":"text"};class I extends d{get nature(){return N}setElementProperties(e){this.value=L(this.value||"#000000").toHexString(),super.setElementProperties(e)}}t.Component.register("input-color",I);const q={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"name",name:"name"},{type:"string",label:"value",name:"text"}],"value-property":"text"};class j extends d{get nature(){return q}setElementProperties(e){super.setElementProperties(e)}}t.Component.register("input-button",j),t.Component.register("input-submit",j),t.Component.register("input-reset",j);const D={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"textarea",label:"template",name:"template"},{type:"string",label:"apply-to",name:"applyTo"}]},U={type:"pattern",fitPattern:!0,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAMFBMVEUAAAAdHR0AAAAAAAAAAAAREREODg4AAAATExMAAAAAAAAAAAAAAAAAAAAWFhYAAABtUS6TAAAAD3RSTlMArnboZDwVtVUHmMTU9CygGbkuAAABBklEQVR42u3Vy47DMAgFUMbE78f9/7+dqpVKFNUzwKqLnD0RvjGYbrdvF8tK9JBWieTRAO6tdQYyeWS8DfIYeONEdmlCLE+GOClkV3ASyC7gpPn+ouiODAdOeJkjHMAZF2OCE1eHK0BfkLXho5yU8XVsjKWKj7E1iya/44kvpcdLJa3LOdg3zIIr2fg7qEd4umYQXpJqiPZyVbQwsMXJtoq889CwkUknMT6ai5QOfBRcb4oY1fMmiBnV1TFk+YDooST6T30UM7a4h5hoS4r/wjnEusleLeiusPFKFwhXCx0GXHUjZBmrDJNRfQ2IYthDYv/grwmrqG1AtV0ShKuF+ONQ6Hb7Hr9EkkNRgwrYbAAAAABJRU5ErkJggg=="};class V extends t.HTMLOverlayContainer{createElement(){super.createElement(),this.element.value=this.get("value")||"",this.element.onchange=(e=>{this.set("value",this.element.value)})}dispose(){super.dispose(),this.targets&&this.targets.forEach(e=>e.shadowRoot.innerHTML="<slot></slot>"),delete this.targets}setElementProperties(e){e.innerHTML=this.state.template}reposition(){super.reposition();var e=this.targets||[],r=this.rootModel&&Array.prototype.slice.call(this.rootModel.overlay.querySelectorAll(this.state.applyTo));r&&r.forEach(r=>{try{!r.shadowRoot&&r.attachShadow({mode:"open"}),r.shadowRoot.innerHTML=this.state.template}catch(e){t.error(e)}let a=e.indexOf(r);a>=0&&e.splice(a,1)}),e.forEach(e=>e.shadowRoot.innerHTML="<slot></slot>"),this.targets=r}get tagName(){return"template"}get fillStyle(){return U}get nature(){return D}}t.Component.register("template",V),e.Form=n,e.FieldSet=i,e.Select=o,e.TextArea=u,e.Button=c,e.Radio=f,e.CheckBox=v,e.IFrame=x,e.Img=A,e.Video=k,e.Link=S,e.Div=T,e.Input=d,e.InputNumber=O,e.InputDate=M,e.InputFile=z,e.InputColor=I,e.InputSubmit=j,e.Template=V,Object.defineProperty(e,"__esModule",{value:!0})});
